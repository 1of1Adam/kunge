<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brooks Encyclopedia - 结构化数据浏览器</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f0f1a;
            color: #e0e0e0;
            min-height: 100vh;
        }
        .header {
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 50%, #1e3a5f 100%);
            padding: 25px 30px;
            text-align: center;
            border-bottom: 3px solid #3d7ab5;
        }
        .header h1 {
            font-size: 26px;
            margin-bottom: 8px;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .header p { opacity: 0.85; font-size: 14px; color: #b0d4f1; }

        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            background: rgba(30,58,95,0.3);
            flex-wrap: wrap;
        }
        .stat-box {
            text-align: center;
            padding: 15px 30px;
            background: rgba(45,90,135,0.4);
            border-radius: 12px;
            border: 1px solid rgba(61,122,181,0.3);
            min-width: 120px;
        }
        .stat-box .num {
            font-size: 32px;
            font-weight: bold;
            color: #5dade2;
            text-shadow: 0 0 10px rgba(93,173,226,0.3);
        }
        .stat-box .label { font-size: 12px; opacity: 0.7; margin-top: 5px; }
        .stat-box.success .num { color: #27ae60; }
        .stat-box.warning .num { color: #f39c12; }
        .stat-box.info .num { color: #3498db; }

        .main-container {
            display: flex;
            height: calc(100vh - 180px);
        }

        .sidebar {
            width: 280px;
            background: rgba(20,30,50,0.9);
            border-right: 1px solid rgba(61,122,181,0.2);
            overflow-y: auto;
            flex-shrink: 0;
        }
        .sidebar-title {
            padding: 15px;
            font-size: 14px;
            font-weight: 600;
            background: rgba(30,58,95,0.5);
            border-bottom: 1px solid rgba(61,122,181,0.2);
        }
        .part-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .part-item:hover { background: rgba(45,90,135,0.3); }
        .part-item.active {
            background: rgba(45,90,135,0.5);
            border-left: 3px solid #5dade2;
        }
        .part-item .name { font-size: 14px; }
        .part-item .count {
            font-size: 11px;
            background: rgba(93,173,226,0.2);
            padding: 2px 8px;
            border-radius: 10px;
            color: #5dade2;
        }

        .content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .part-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(61,122,181,0.2);
        }
        .part-header h2 {
            font-size: 20px;
            color: #5dade2;
        }
        .part-meta {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #888;
        }
        .part-meta span {
            background: rgba(45,90,135,0.3);
            padding: 5px 12px;
            border-radius: 6px;
        }

        .section-card {
            background: rgba(25,40,65,0.6);
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid rgba(61,122,181,0.15);
            overflow: hidden;
            transition: all 0.2s;
        }
        .section-card:hover {
            border-color: rgba(61,122,181,0.4);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .section-header {
            padding: 15px 20px;
            background: rgba(30,58,95,0.4);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .section-header:hover { background: rgba(30,58,95,0.6); }
        .section-title {
            font-size: 15px;
            font-weight: 500;
            color: #fff;
            flex: 1;
        }
        .section-badges {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .badge {
            font-size: 11px;
            padding: 3px 10px;
            border-radius: 12px;
            font-weight: 600;
        }
        .badge-abbrev {
            background: rgba(93,173,226,0.2);
            color: #5dade2;
            font-family: monospace;
        }
        .badge-slide {
            background: rgba(39,174,96,0.2);
            color: #27ae60;
        }
        .badge-count {
            background: rgba(243,156,18,0.2);
            color: #f39c12;
        }
        .badge-match {
            font-size: 10px;
            padding: 2px 6px;
        }
        .badge-exact { background: #27ae60; color: #fff; }
        .badge-fuzzy { background: #f39c12; color: #000; }
        .badge-manual { background: #9b59b6; color: #fff; }

        .section-body {
            padding: 0 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }
        .section-card.expanded .section-body {
            padding: 15px 20px;
            max-height: 1000px;
        }

        .slide-info {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .slide-info label {
            font-size: 11px;
            color: #888;
            display: block;
            margin-bottom: 4px;
        }
        .slide-info .value {
            font-size: 14px;
            color: #b0d4f1;
        }

        .children-list {
            margin-top: 10px;
        }
        .children-list h4 {
            font-size: 12px;
            color: #888;
            margin-bottom: 10px;
        }
        .child-item {
            padding: 8px 12px;
            background: rgba(15,25,45,0.5);
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 13px;
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }
        .child-item .num {
            color: #5dade2;
            font-family: monospace;
            min-width: 45px;
        }
        .child-item .title { color: #ccc; }

        .extra-groups {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px dashed rgba(61,122,181,0.3);
        }
        .extra-groups h3 {
            font-size: 16px;
            color: #f39c12;
            margin-bottom: 15px;
        }
        .extra-card {
            background: rgba(50,40,25,0.4);
            border: 1px dashed rgba(243,156,18,0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
        }
        .extra-card .title { font-size: 14px; color: #f5d9a8; }
        .extra-card .meta { font-size: 12px; color: #888; margin-top: 5px; }

        .search-bar {
            padding: 10px 15px;
            background: rgba(20,30,50,0.8);
            border-bottom: 1px solid rgba(61,122,181,0.2);
        }
        .search-bar input {
            width: 100%;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid rgba(61,122,181,0.3);
            background: rgba(15,25,45,0.8);
            color: #fff;
            font-size: 14px;
        }
        .search-bar input::placeholder { color: #666; }
        .search-bar input:focus {
            outline: none;
            border-color: #5dade2;
        }

        #loadingOverlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: #0f0f1a;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 1000;
        }
        .spinner {
            width: 50px; height: 50px;
            border: 3px solid rgba(93,173,226,0.2);
            border-top-color: #5dade2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .loading-text { margin-top: 15px; color: #5dade2; font-size: 14px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .expand-icon {
            width: 20px;
            height: 20px;
            transition: transform 0.2s;
            opacity: 0.5;
        }
        .section-card.expanded .expand-icon { transform: rotate(180deg); }
    </style>
</head>
<body>
    <div id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-text">Loading Encyclopedia Data...</div>
    </div>

    <div class="header">
        <h1>Brooks Encyclopedia of Chart Patterns</h1>
        <p>Complete Structured Data Browser - Version October 1, 2025</p>
    </div>

    <div class="stats" id="statsBar">
        <div class="stat-box">
            <div class="num" id="statParts">16</div>
            <div class="label">Total Parts</div>
        </div>
        <div class="stat-box success">
            <div class="num" id="statSections">-</div>
            <div class="label">Sections Matched</div>
        </div>
        <div class="stat-box info">
            <div class="num" id="statSlides">-</div>
            <div class="label">Total Slides</div>
        </div>
        <div class="stat-box warning">
            <div class="num" id="statExtra">-</div>
            <div class="label">Extra Groups</div>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search sections...">
            </div>
            <div class="sidebar-title">Parts</div>
            <div id="partList"></div>
        </div>
        <div class="content" id="contentArea">
            <div style="text-align:center; padding: 60px; color: #666;">
                Select a Part from the sidebar to view its sections
            </div>
        </div>
    </div>

    <script>
        let encyclopediaData = null;
        let currentPart = null;

        async function loadData() {
            try {
                const resp = await fetch('encyclopedia_complete.json');
                encyclopediaData = await resp.json();

                document.getElementById('statSections').textContent = encyclopediaData.metadata.totalSections;
                document.getElementById('statSlides').textContent = encyclopediaData.metadata.totalSlides.toLocaleString();

                // 隐藏 Extra Groups 统计（不再需要）
                document.getElementById('statExtra').parentElement.style.display = 'none';

                renderPartList();
                document.getElementById('loadingOverlay').style.display = 'none';

                // Auto select Part 1
                selectPart('part01');
            } catch (e) {
                console.error('Failed to load data:', e);
                document.getElementById('loadingOverlay').innerHTML =
                    '<div style="color: #e74c3c;">Failed to load data. Please ensure encyclopedia_structured.json exists.</div>';
            }
        }

        function renderPartList() {
            const container = document.getElementById('partList');
            let html = '';

            for (let i = 1; i <= 16; i++) {
                const partId = `part${String(i).padStart(2, '0')}`;
                const partData = encyclopediaData.parts[partId];
                const sectionCount = partData ? partData.sectionCount : 0;

                html += `
                    <div class="part-item" data-part="${partId}" onclick="selectPart('${partId}')">
                        <span class="name">Part ${i}</span>
                        <span class="count">${sectionCount} sections</span>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function selectPart(partId) {
            currentPart = partId;

            // Update sidebar selection
            document.querySelectorAll('.part-item').forEach(el => el.classList.remove('active'));
            document.querySelector(`.part-item[data-part="${partId}"]`)?.classList.add('active');

            renderPartContent(partId);
        }

        function renderPartContent(partId) {
            const partData = encyclopediaData.parts[partId];
            if (!partData) return;

            const container = document.getElementById('contentArea');
            const partNum = partData.partNum;

            let html = `
                <div class="part-header">
                    <h2>Part ${partNum}</h2>
                    <div class="part-meta">
                        <span>${partData.sectionCount} Sections</span>
                        <span>${partData.slideCount} Slides</span>
                    </div>
                </div>
            `;

            // Sections
            for (const section of partData.sections) {
                html += `
                    <div class="section-card" onclick="toggleSection(this)">
                        <div class="section-header">
                            <span class="section-title">${escapeHtml(section.title)}</span>
                            <div class="section-badges">
                                <span class="badge badge-slide">Slide ${section.slideNum}</span>
                                <span class="badge badge-count">${section.childCount} pages</span>
                                <svg class="expand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 9l6 6 6-6"/>
                                </svg>
                            </div>
                        </div>
                        <div class="section-body">
                            ${section.children.length > 0 ? `
                            <div class="children-list">
                                <h4>Child Slides (${section.childCount})</h4>
                                ${section.children.map(child => `
                                    <div class="child-item">
                                        <span class="num">#${child.slideNum}</span>
                                        <span class="title">${escapeHtml(child.title)}</span>
                                    </div>
                                `).join('')}
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function toggleSection(card) {
            card.classList.toggle('expanded');
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            if (!query) {
                if (currentPart) renderPartContent(currentPart);
                return;
            }

            const results = [];
            for (const [partId, partData] of Object.entries(encyclopediaData.parts)) {
                for (const section of partData.sections) {
                    if (section.title.toLowerCase().includes(query)) {
                        results.push({ partId, partNum: partData.partNum, section });
                    }
                }
            }

            renderSearchResults(results, query);
        });

        function renderSearchResults(results, query) {
            const container = document.getElementById('contentArea');

            if (results.length === 0) {
                container.innerHTML = `
                    <div style="text-align:center; padding: 60px; color: #666;">
                        No results found for "${escapeHtml(query)}"
                    </div>
                `;
                return;
            }

            let html = `
                <div class="part-header">
                    <h2>Search Results</h2>
                    <div class="part-meta">
                        <span>${results.length} matches for "${escapeHtml(query)}"</span>
                    </div>
                </div>
            `;

            for (const { partNum, section } of results) {
                html += `
                    <div class="section-card" onclick="toggleSection(this)">
                        <div class="section-header">
                            <span class="section-title">
                                <span class="badge" style="background:#2d5a87;color:#fff;margin-right:10px;">Part ${partNum}</span>
                                ${escapeHtml(section.title)}
                            </span>
                            <div class="section-badges">
                                <span class="badge badge-slide">Slide ${section.slideNum}</span>
                                <span class="badge badge-count">${section.childCount} pages</span>
                            </div>
                        </div>
                        <div class="section-body">
                            ${section.children.length > 0 ? `
                            <div class="children-list">
                                <h4>Child Slides (${section.childCount})</h4>
                                ${section.children.slice(0, 5).map(child => `
                                    <div class="child-item">
                                        <span class="num">#${child.slideNum}</span>
                                        <span class="title">${escapeHtml(child.title)}</span>
                                    </div>
                                `).join('')}
                                ${section.children.length > 5 ? `<div style="color:#888;font-size:12px;padding:8px;">... and ${section.children.length - 5} more</div>` : ''}
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // Load data on page load
        loadData();
    </script>
</body>
</html>
