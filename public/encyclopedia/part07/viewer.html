<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brooks Encyclopedia - Part 7: GU – GU M</title>
    <style>
@font-face { font-family: 'PFn'; src: url('fonts/fnt0.woff') format('woff'); }
@font-face { font-family: 'PFnb'; src: url('fonts/fnt1.woff') format('woff'); font-weight: bold; }
@font-face { font-family: 'fnt4'; src: url('fonts/fnt4.woff') format('woff'); }
@font-face { font-family: 'fnt5'; src: url('fonts/fnt5.woff') format('woff'); }
@font-face { font-family: 'fnt6'; src: url('fonts/fnt6.woff') format('woff'); }
@font-face { font-family: 'fnt7'; src: url('fonts/fnt7.woff') format('woff'); }
@font-face { font-family: 'fnt8'; src: url('fonts/fnt8.woff') format('woff'); }

* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    min-height: 100vh; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}
.controls {
    display: flex; align-items: center; gap: 20px; margin-bottom: 20px; padding: 15px 30px;
    background: rgba(255,255,255,0.1); border-radius: 50px; backdrop-filter: blur(10px);
}
.nav-btn {
    width: 50px; height: 50px; border: none; border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white; font-size: 24px; cursor: pointer; transition: all 0.3s ease;
    display: flex; align-items: center; justify-content: center;
}
.nav-btn:hover:not(:disabled) { transform: scale(1.1); box-shadow: 0 5px 20px rgba(102,126,234,0.5); }
.nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }
.slide-info { color: white; font-size: 18px; font-weight: 500; min-width: 120px; text-align: center; }
.slide-select { padding: 10px 15px; font-size: 16px; border: none; border-radius: 25px; background: rgba(255,255,255,0.2); color: white; cursor: pointer; }
.slide-select option { background: #1a1a2e; color: white; }
.slide-wrapper { box-shadow: 0 20px 60px rgba(0,0,0,0.5); border-radius: 8px; overflow: hidden; }
.playerView { width: 960px; height: 540px; position: relative; background: #fff; overflow: hidden; }
.playerView * { position: absolute; }
.playerView > * { position: absolute; }
.playerView .slide { position: absolute; width: 960px; height: 540px; top: 0; left: 0; white-space: nowrap; font-size: 0px; }
.playerView .slide * { transform-origin: 0px 0px; -webkit-transform-origin: 0px 0px; }
.playerView .slide.relpos, .playerView .slide .relpos { position: relative !important; vertical-align: top !important; }
.playerView .slide.kern, .playerView .slide .kern { text-rendering: optimizeLegibility; font-feature-settings: "kern" 1, "liga" 0; }
.playerView .slide.nokern, .playerView .slide .nokern { text-rendering: optimizeSpeed; font-feature-settings: "kern" 0, "liga" 0; }
.playerView [id^="spr"] { position: absolute; }
.playerView [id^="svg"] { position: absolute; }
.playerView [id^="img"] { position: absolute; }
.playerView span[id^="txt"] { position: absolute; white-space: nowrap; letter-spacing: normal; }
.footer-info { margin-top: 20px; color: #888; font-size: 13px; text-align: center; }
.keyboard-hint { margin-top: 10px; color: #666; font-size: 12px; }
.keyboard-hint kbd { background: rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 4px; margin: 0 3px; }
.loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); color: #666; font-size: 18px; }
</style>
</head>
<body>
    <div class="controls">
        <button class="nav-btn" id="prevBtn" onclick="prevSlide()" title="上一张">◀</button>
        <span class="slide-info" id="slideInfo">Slide 1 / 412</span>
        <button class="nav-btn" id="nextBtn" onclick="nextSlide()" title="下一张">▶</button>
        <select class="slide-select" id="slideSelect" onchange="goToSlide(this.value)"></select>
    </div>
    <div class="slide-wrapper">
        <div class="playerView" id="slideContainer"><div class="loading">加载中</div></div>
    </div>
    <div class="footer-info">
        <p><strong>Brooks Trading Course Encyclopedia</strong></p>
        <p>Part 7: GU – GU M (412 slides)</p>
    </div>
    <div class="keyboard-hint">快捷键: <kbd>←</kbd> 上一张 | <kbd>→</kbd> 下一张 | <kbd>Home</kbd> 第一张 | <kbd>End</kbd> 最后一张</div>
    <script>
        const TOTAL_SLIDES = 412;
        let currentSlide = 1, slideCache = {}, cssCache = {};
        function initSelector() {
            const s = document.getElementById('slideSelect');
            for (let i = 1; i <= TOTAL_SLIDES; i++) { const o = document.createElement('option'); o.value = i; o.textContent = `Slide ${i}`; s.appendChild(o); }
        }
        function extractHtmlFromJs(js) {
            const m = js.match(/loadHandler\s*\(\s*\d+\s*,\s*'([\s\S]*?)'\s*,\s*'\{/);
            return m ? m[1].replace(/\\'/g,"'").replace(/\\"/g,'"').replace(/\\\\/g,'\\') : null;
        }
        async function loadSlide(n) {
            const c = document.getElementById('slideContainer');
            c.innerHTML = '<div class="loading">加载中</div>';
            try {
                if (!cssCache[n]) cssCache[n] = await (await fetch(`data/slide${n}.css`)).text();
                if (!slideCache[n]) slideCache[n] = extractHtmlFromJs(await (await fetch(`data/slide${n}.js`)).text());
                const old = document.getElementById('dynamicSlideStyle'); if (old) old.remove();
                const style = document.createElement('style'); style.id = 'dynamicSlideStyle'; style.textContent = cssCache[n]; document.head.appendChild(style);
                c.innerHTML = slideCache[n] || '<div class="loading">无法解析</div>';
            } catch (e) { c.innerHTML = `<div class="loading">加载失败</div>`; }
            updateUI();
        }
        function updateUI() {
            document.getElementById('slideInfo').textContent = `Slide ${currentSlide} / ${TOTAL_SLIDES}`;
            document.getElementById('slideSelect').value = currentSlide;
            document.getElementById('prevBtn').disabled = currentSlide <= 1;
            document.getElementById('nextBtn').disabled = currentSlide >= TOTAL_SLIDES;
        }
        function nextSlide() { if (currentSlide < TOTAL_SLIDES) { currentSlide++; loadSlide(currentSlide); } }
        function prevSlide() { if (currentSlide > 1) { currentSlide--; loadSlide(currentSlide); } }
        function goToSlide(n) { n = parseInt(n); if (n >= 1 && n <= TOTAL_SLIDES) { currentSlide = n; loadSlide(n); } }
        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowRight' || e.key === ' ') nextSlide();
            else if (e.key === 'ArrowLeft') prevSlide();
            else if (e.key === 'Home') goToSlide(1);
            else if (e.key === 'End') goToSlide(TOTAL_SLIDES);
        });
        initSelector(); loadSlide(1);
    </script>
</body>
</html>
